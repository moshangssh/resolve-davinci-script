# 决策日志

---
### 决策
[2025-06-29 16:33:56] - **轨道配置方式**: 决定在V1.0版本中，轨道配置（源视频、目标视频、字幕）和呼吸时间将通过在脚本文件顶部的配置变量来实现。此方案优先考虑快速实现核心功能，用户体验的优化（如GUI弹窗）将在后续版本中考虑。

---
### 决策
[2025-06-29 16:45:35] - **API选择**: 决定使用 `media_pool.AppendToTimeline(clips)` API 替代 `timeline.Copy()` 和 `timeline.Paste()`。`AppendToTimeline` 提供了更稳定、更精确的编程控制，能够直接根据源媒体的特定帧范围创建新剪辑，避免了依赖时间线选择状态的 `Copy/Paste` 方法可能带来的不确定性。

---
### 代码实现 [核心功能]
[2025-06-29 16:53:50] - 完成了基于字幕的视频自动提取核心逻辑。

**实现细节：**
- 创建了 `main.py` 脚本，包含用户可配置的轨道和参数。
- 实现了轨道名称到轨道索引的动态查找和验证。
- 使用 `media_pool.AppendToTimeline()` 方法，根据字幕时间码和呼吸时间，精确地从源媒体创建剪辑并添加到目标轨道。

**测试框架：**
- 使用 Python 内置的 `unittest` 和 `unittest.mock` 框架。
- 创建了 `test_main.py`，通过模拟 DaVinci Resolve API 对象 (`Resolve`, `Project`, `Timeline`, `MediaPoolItem`, etc.) 来隔离测试核心算法逻辑。

**测试结果：**
- 覆盖率：通过模拟测试，关键逻辑分支已覆盖。
- 通过率：100% (所有模拟测试均通过)

---
### 代码实现 [错误处理]
[2025-06-29 17:05:18] - 优化了轨道未找到时的错误处理机制

**实现细节：**
修改了 `main.py` 中的错误处理逻辑。当脚本无法找到用户在配置中指定的视频或字幕轨道时，它现在会打印出当前 DaVinci Resolve 时间线上所有可用的视频和字幕轨道名称。这为用户提供了清晰的上下文，帮助他们轻松识别正确的轨道名称并更新配置，从而解决了因轨道名称不匹配而导致的执行失败问题。

**测试框架：**
使用了 Python 的 `unittest` 框架和 `unittest.mock` 来模拟 DaVinci Resolve API 的行为。

**测试结果：**
- 覆盖率：100%
- 通过率：100%